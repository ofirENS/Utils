<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="41,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T20U3">A</span>,<span class="var type1" id="S3T20U4">B</span>,<span class="var type1" id="S4T20U5">Bstar</span>,<span class="var type1" id="S5T20U6">D</span>] = CalculateABBStarD(<span class="var type1" id="S6T1U9">N</span>,<span class="var type1" id="S7T2U10">t</span>,<span class="var type1" id="S8T2U11">gridT</span>,<span class="var type1" id="S9T2U12">x</span>,<span class="var type1" id="S10T20U13">f</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="41,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% Calculate A and B, B*, and D</span></span></span>
<span class="srcline"><span class="lineno"><a href="41,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% N is the number of time points</span></span></span>
<span class="srcline"><span class="lineno"><a href="41,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% grid T is the time points grid on which the solution is calculated </span></span></span>
<span class="srcline"><span class="lineno"><a href="41,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% f is the multiplicative function for the source f(x,t)*r(t), size [N,</span></span></span>
<span class="srcline"><span class="lineno"><a href="41,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% N0], with N0 the number of space points</span></span></span>
<span class="srcline"><span class="lineno"><a href="41,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="41,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo" id="T20:U10"><span class="var type1" id="S2T20U16">A</span>      = <span class="mxinfo" id="T20:U12">zeros(<span class="mxinfo" id="T1:U13"><span class="mxinfo" id="T1:U14">2</span>*<span class="var type1" id="S6T1U21">N</span></span>,<span class="mxinfo" id="T1:U16"><span class="mxinfo" id="T1:U17">2</span>*<span class="var type1" id="S6T1U24">N</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="41,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo" id="T20:U19"><span class="var type1" id="S3T20U27">B</span>      = <span class="mxinfo" id="T20:U21">zeros(<span class="mxinfo" id="T1:U22"><span class="mxinfo" id="T1:U23">2</span>*<span class="var type1" id="S6T1U32">N</span></span>,<span class="mxinfo" id="T1:U25"><span class="mxinfo" id="T1:U26">2</span>*<span class="var type1" id="S6T1U35">N</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="41,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo" id="T20:U28"><span class="var type1" id="S4T20U38">Bstar</span>  = <span class="mxinfo" id="T20:U30">zeros(<span class="mxinfo" id="T1:U31"><span class="mxinfo" id="T1:U32">2</span>*<span class="var type1" id="S6T1U43">N</span></span>,<span class="mxinfo" id="T1:U34"><span class="mxinfo" id="T1:U35">2</span>*<span class="var type1" id="S6T1U46">N</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="41,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo" id="T20:U37"><span class="var type1" id="S5T20U49">D</span>      = <span class="mxinfo" id="T20:U39">zeros(<span class="mxinfo" id="T1:U40"><span class="mxinfo" id="T1:U41">2</span>*<span class="var type1" id="S6T1U54">N</span></span>,<span class="var type1" id="S6T1U55">N</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="41,12" id="srcline12">12</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S12T1U58">i</span> = <span class="mxinfo" id="T1:U45">1</span>:<span class="var type1" id="S6T1U61">N</span> <span class="comment">% time</span></span></span>
<span class="srcline"><span class="lineno"><a href="41,13" id="srcline13">13</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S13T1U64">j</span> = <span class="mxinfo" id="T1:U48">1</span>:<span class="var type1" id="S6T1U67">N</span> <span class="comment">% time</span></span></span>
<span class="srcline"><span class="lineno"><a href="41,14" id="srcline14">14</a></span><span class="line">        <span class="mxinfo" id="T1:U50"><span class="var type1" id="S14T1U70">deltaij</span> = <span class="mxinfo" id="T1:U52">double(<span class="mxinfo" id="T3:U53"><span class="var type1" id="S12T1U74">i</span>==<span class="var type1" id="S13T1U75">j</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="41,15" id="srcline15">15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="41,16" id="srcline16">16</a></span><span class="line">        <span class="mxinfo" id="T53:U56"><span class="mxinfo" id="T53:U57"><span class="var type1" id="S2T20U79">A</span>(<span class="mxinfo" id="T54:U59">(<span class="mxinfo" id="T1:U60"><span class="mxinfo" id="T1:U61"><span class="mxinfo" id="T1:U62">2</span>*<span class="var type1" id="S12T1U85">i</span></span>-1</span>):2*<span class="var type1" id="S12T1U89">i</span></span>,<span class="mxinfo" id="T54:U65">(<span class="mxinfo" id="T1:U66"><span class="mxinfo" id="T1:U67"><span class="mxinfo" id="T1:U68">2</span>*<span class="var type1" id="S13T1U95">j</span></span>-1</span>):2*<span class="var type1" id="S13T1U99">j</span></span>)</span> = <span class="mxinfo" id="T53:U71">[<span class="mxinfo" id="T15:U72"><span class="mxinfo" id="T1:U73"><span class="fcn" id="F1N2:B103">Acoeff</span>(<span class="mxinfo" id="T1:U74">0</span>,<span class="var type1" id="S13T1U105">j</span>,<span class="mxinfo" id="T1:U76">0</span>,<span class="mxinfo" id="T1:U77"><span class="var type1" id="S7T2U108">t</span>(<span class="var type1" id="S12T1U109">i</span>)</span>,<span class="var type1" id="S8T2U110">gridT</span>)</span>, <span class="mxinfo" id="T1:U81"><span class="fcn" id="F1N2:B112">Acoeff</span>(<span class="mxinfo" id="T1:U82">1</span>,<span class="var type1" id="S13T1U114">j</span>,<span class="mxinfo" id="T1:U84">0</span>,<span class="mxinfo" id="T1:U85"><span class="var type1" id="S7T2U117">t</span>(<span class="var type1" id="S12T1U118">i</span>)</span>,<span class="var type1" id="S8T2U119">gridT</span>)</span></span>;<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="41,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo" id="T53:U56"><span class="mxinfo" id="T53:U71">                                      <span class="mxinfo" id="T15:U89"><span class="mxinfo" id="T1:U90"><span class="fcn" id="F1N2:B122">Acoeff</span>(<span class="mxinfo" id="T1:U91">0</span>,<span class="var type1" id="S13T1U124">j</span>,<span class="mxinfo" id="T1:U93">1</span>,<span class="mxinfo" id="T1:U94"><span class="var type1" id="S7T2U127">t</span>(<span class="var type1" id="S12T1U128">i</span>)</span>,<span class="var type1" id="S8T2U129">gridT</span>)</span>, <span class="mxinfo" id="T1:U98"><span class="fcn" id="F1N2:B131">Acoeff</span>(<span class="mxinfo" id="T1:U99">1</span>,<span class="var type1" id="S13T1U133">j</span>,<span class="mxinfo" id="T1:U101">1</span>,<span class="mxinfo" id="T1:U102"><span class="var type1" id="S7T2U136">t</span>(<span class="var type1" id="S12T1U137">i</span>)</span>,<span class="var type1" id="S8T2U138">gridT</span>)</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="41,18" id="srcline18">18</a></span><span class="line">        <span class="comment">% temp terms</span></span></span>
<span class="srcline"><span class="lineno"><a href="41,19" id="srcline19">19</a></span><span class="line">        <span class="mxinfo" id="T1:U106"><span class="var type1" id="S17T1U141">b1j0i</span> = <span class="mxinfo" id="T1:U108"><span class="fcn" id="F74N3:B143">Bcoeff</span>(<span class="mxinfo" id="T1:U109">1</span>,<span class="var type1" id="S13T1U145">j</span>,<span class="mxinfo" id="T1:U111">0</span>,<span class="mxinfo" id="T1:U112"><span class="var type1" id="S7T2U148">t</span>(<span class="var type1" id="S12T1U149">i</span>)</span>,<span class="var type1" id="S8T2U150">gridT</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="41,20" id="srcline20">20</a></span><span class="line">        <span class="mxinfo" id="T1:U116"><span class="var type1" id="S19T1U153">b1j1i</span> = <span class="mxinfo" id="T1:U118"><span class="fcn" id="F74N3:B155">Bcoeff</span>(<span class="mxinfo" id="T1:U119">1</span>,<span class="var type1" id="S13T1U157">j</span>,<span class="mxinfo" id="T1:U121">1</span>,<span class="mxinfo" id="T1:U122"><span class="var type1" id="S7T2U160">t</span>(<span class="var type1" id="S12T1U161">i</span>)</span>,<span class="var type1" id="S8T2U162">gridT</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="41,21" id="srcline21">21</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="41,22" id="srcline22">22</a></span><span class="line">        <span class="mxinfo" id="T53:U126"><span class="mxinfo" id="T53:U127"><span class="var type1" id="S3T20U166">B</span>(<span class="mxinfo" id="T54:U129">(<span class="mxinfo" id="T1:U130"><span class="mxinfo" id="T1:U131"><span class="mxinfo" id="T1:U132">2</span>*<span class="var type1" id="S12T1U172">i</span></span>-1</span>):2*<span class="var type1" id="S12T1U176">i</span></span>,<span class="mxinfo" id="T54:U135">(<span class="mxinfo" id="T1:U136"><span class="mxinfo" id="T1:U137"><span class="mxinfo" id="T1:U138">2</span>*<span class="var type1" id="S13T1U182">j</span></span>-1</span>):2*<span class="var type1" id="S13T1U186">j</span></span>)</span> = <span class="mxinfo" id="T53:U141">[<span class="mxinfo" id="T15:U142"><span class="mxinfo" id="T1:U143"><span class="mxinfo" id="T1:U144"><span class="fcn" id="F74N3:B191">Bcoeff</span>(<span class="mxinfo" id="T1:U145">0</span>,<span class="var type1" id="S13T1U193">j</span>,<span class="mxinfo" id="T1:U147">0</span>,<span class="mxinfo" id="T1:U148"><span class="var type1" id="S7T2U196">t</span>(<span class="var type1" id="S12T1U197">i</span>)</span>,<span class="var type1" id="S8T2U198">gridT</span>)</span>+<span class="mxinfo" id="T1:U152"><span class="mxinfo" id="T1:U153">0.5</span>*<span class="var type1" id="S14T1U201">deltaij</span></span></span>, <span class="var type1" id="S17T1U202">b1j0i</span></span>;<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="41,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo" id="T53:U126"><span class="mxinfo" id="T53:U141">                                      <span class="mxinfo" id="T15:U156"><span class="mxinfo" id="T1:U157"><span class="fcn" id="F74N3:B205">Bcoeff</span>(<span class="mxinfo" id="T1:U158">0</span>,<span class="var type1" id="S13T1U207">j</span>,<span class="mxinfo" id="T1:U160">1</span>,<span class="mxinfo" id="T1:U161"><span class="var type1" id="S7T2U210">t</span>(<span class="var type1" id="S12T1U211">i</span>)</span>,<span class="var type1" id="S8T2U212">gridT</span>)</span>, <span class="mxinfo" id="T1:U165"><span class="var type1" id="S19T1U214">b1j1i</span>+<span class="mxinfo" id="T1:U167"><span class="mxinfo" id="T1:U168">0.5</span>*<span class="var type1" id="S14T1U217">deltaij</span></span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="41,24" id="srcline24">24</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="41,25" id="srcline25">25</a></span><span class="line">        <span class="mxinfo" id="T53:U170"><span class="mxinfo" id="T53:U171"><span class="var type1" id="S4T20U221">Bstar</span>(<span class="mxinfo" id="T54:U173">(<span class="mxinfo" id="T1:U174"><span class="mxinfo" id="T1:U175"><span class="mxinfo" id="T1:U176">2</span>*<span class="var type1" id="S12T1U227">i</span></span>-1</span>):2*<span class="var type1" id="S12T1U231">i</span></span>,<span class="mxinfo" id="T54:U179">(<span class="mxinfo" id="T1:U180"><span class="mxinfo" id="T1:U181"><span class="mxinfo" id="T1:U182">2</span>*<span class="var type1" id="S13T1U237">j</span></span>-1</span>):2*<span class="var type1" id="S13T1U241">j</span></span>)</span> = <span class="mxinfo" id="T53:U185">[<span class="mxinfo" id="T15:U186"><span class="var type1" id="S17T1U244">b1j0i</span>,           <span class="mxinfo" id="T1:U188">-<span class="var type1" id="S17T1U246">b1j0i</span></span></span>;<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="41,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo" id="T53:U170"><span class="mxinfo" id="T53:U185">                                          <span class="mxinfo" id="T15:U190"><span class="mxinfo" id="T1:U191"><span class="var type1" id="S19T1U249">b1j1i</span>+<span class="mxinfo" id="T1:U193"><span class="var type1" id="S14T1U251">deltaij</span>/<span class="mxinfo" id="T1:U195">2</span></span></span>, <span class="mxinfo" id="T1:U196"><span class="mxinfo" id="T1:U197">-<span class="var type1" id="S19T1U255">b1j1i</span></span>-<span class="mxinfo" id="T1:U199"><span class="mxinfo" id="T1:U200">0.5</span>*<span class="var type1" id="S14T1U258">deltaij</span></span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="41,27" id="srcline27">27</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="41,28" id="srcline28">28</a></span><span class="line">        <span class="mxinfo" id="T54:U202"><span class="mxinfo" id="T54:U203"><span class="var type1" id="S5T20U262">D</span>(<span class="mxinfo" id="T54:U205">(<span class="mxinfo" id="T1:U206"><span class="mxinfo" id="T1:U207"><span class="mxinfo" id="T1:U208">2</span>*<span class="var type1" id="S12T1U268">i</span></span>-1</span>):2*<span class="var type1" id="S12T1U272">i</span></span>,<span class="var type1" id="S13T1U273">j</span>)</span>= <span class="mxinfo" id="T54:U212">[<span class="mxinfo" id="T1:U213">Dcoeff(<span class="var type1" id="S9T2U278">x</span>,<span class="var type1" id="S13T1U279">j</span>,0,<span class="mxinfo" id="T1:U216"><span class="var type1" id="S7T2U282">t</span>(<span class="var type1" id="S12T1U283">i</span>)</span>,<span class="var type1" id="S8T2U284">gridT</span>,<span class="mxinfo" id="T2:U220"><span class="var type1" id="S10T20U286">f</span>(<span class="var type1" id="S12T1U287">i</span>,:)</span>)</span>;<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="41,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo" id="T54:U202"><span class="mxinfo" id="T54:U212">                           <span class="mxinfo" id="T1:U223">Dcoeff(<span class="var type1" id="S9T2U292">x</span>,<span class="var type1" id="S13T1U293">j</span>,1,<span class="mxinfo" id="T1:U226"><span class="var type1" id="S7T2U296">t</span>(<span class="var type1" id="S12T1U297">i</span>)</span>,<span class="var type1" id="S8T2U298">gridT</span>,<span class="mxinfo" id="T2:U230"><span class="var type1" id="S10T20U300">f</span>(<span class="var type1" id="S12T1U301">i</span>,:)</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="41,30" id="srcline30">30</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="41,31" id="srcline31">31</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="41,32" id="srcline32">32</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
