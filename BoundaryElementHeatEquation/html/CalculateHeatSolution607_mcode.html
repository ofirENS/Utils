<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="45,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T20U3">u</span>] = CalculateHeatSolution(<span class="var type1" id="S3T1U6">N0</span>,<span class="var type1" id="S4T1U7">N</span>,<span class="var type1" id="S5T2U8">t</span>,<span class="var type1" id="S6T2U9">gridT</span>, <span class="var type1" id="S7T2U10">x</span>, <span class="var type1" id="S8T2U11">u0</span>, <span class="var type1" id="S9T21U12">q0j</span>, <span class="var type1" id="S10T21U13">q1j</span>,<span class="var type1" id="S11T20U14">h0j</span>,<span class="var type1" id="S12T20U15">h1j</span>,<span class="var type1" id="S13T20U16">f</span>,<span class="var type1" id="S14T21U17">r</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="45,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% get the solution for the inverse heat source, u(x,t), </span></span></span>
<span class="srcline"><span class="lineno"><a href="45,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% N0 - number of space points</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% N  - number of time points</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% t  - time points</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% gridT - time points grid</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% x space points</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">% q0j flux at x=0 du/dn</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% q1j flux at x=1 du/dn</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,10" id="srcline10">10</a></span><span class="line"><span class="comment">% h0j boundary condition u(0,t)</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,11" id="srcline11">11</a></span><span class="line"><span class="comment">% u1j boundary condition u(1,t)</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,12" id="srcline12">12</a></span><span class="line"><span class="comment">% f multiplier of the source f(x,t)r(t) size[N N0]</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,13" id="srcline13">13</a></span><span class="line"><span class="comment">% r calculated source term size [N,1]</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="45,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo" id="T2:U14"><span class="var type1" id="S15T2U20">eta</span>     = <span class="mxinfo" id="T2:U16">ones(<span class="mxinfo" id="T1:U17">1</span>,<span class="var type1" id="S3T1U24">N0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo" id="T1:U19"><span class="mxinfo" id="T1:U20"><span class="var type1" id="S15T2U28">eta</span>(<span class="mxinfo" id="T1:U22">1</span>)</span>  = <span class="mxinfo" id="T1:U23">0.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo" id="T1:U24"><span class="mxinfo" id="T1:U25"><span class="var type1" id="S15T2U34">eta</span>(<span class="var type1" id="S3T1U35">N0</span>)</span> = <span class="mxinfo" id="T1:U28">0.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo" id="T20:U29"><span class="var type1" id="S2T20U39">u</span>       = <span class="mxinfo" id="T20:U31">zeros(<span class="var type1" id="S4T1U42">N</span>,<span class="var type1" id="S3T1U43">N0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,19" id="srcline19">19</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S18T1U46">j</span>=<span class="mxinfo" id="T1:U35">1</span>:<span class="var type1" id="S3T1U49">N0</span>    <span class="comment">% space index</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,20" id="srcline20">20</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S19T1U52">i</span>=<span class="mxinfo" id="T1:U38">1</span>:<span class="var type1" id="S4T1U55">N</span> <span class="comment">% time index</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,21" id="srcline21">21</a></span><span class="line">        <span class="mxinfo" id="T1:U40"><span class="var type1" id="S20T1U58">sTime</span>   = <span class="mxinfo" id="T1:U42">0</span></span>;<span class="comment">% cumulative sums</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,22" id="srcline22">22</a></span><span class="line">        <span class="mxinfo" id="T1:U43"><span class="var type1" id="S21T1U62">sSpace</span>  = <span class="mxinfo" id="T1:U45">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,23" id="srcline23">23</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="45,24" id="srcline24">24</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S22T1U66">tIdx</span> = <span class="mxinfo" id="T1:U47">1</span>:<span class="var type1" id="S4T1U69">N</span> <span class="comment">% time index</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,25" id="srcline25">25</a></span><span class="line">            <span class="mxinfo" id="T1:U49"><span class="var type1" id="S20T1U72">sTime</span> = <span class="mxinfo" id="T1:U51"><span class="mxinfo" id="T1:U52"><span class="mxinfo" id="T1:U53"><span class="mxinfo" id="T1:U54"><span class="mxinfo" id="T1:U55"><span class="var type1" id="S20T1U78">sTime</span>+ <span class="mxinfo" id="T1:U57"><span class="mxinfo" id="T1:U58"><span class="fcn" id="F1N2:B81">Acoeff</span>(<span class="mxinfo" id="T1:U59">0</span>,<span class="var type1" id="S22T1U83">tIdx</span>,<span class="mxinfo" id="T1:U61"><span class="var type1" id="S7T2U85">x</span>(<span class="var type1" id="S18T1U86">j</span>)</span>,<span class="mxinfo" id="T1:U64"><span class="var type1" id="S5T2U88">t</span>(<span class="var type1" id="S19T1U89">i</span>)</span>,<span class="var type1" id="S6T2U90">gridT</span>)</span>*<span class="mxinfo" id="T1:U68"><span class="var type1" id="S9T21U92">q0j</span>(<span class="var type1" id="S22T1U93">tIdx</span>)</span></span></span> + <span class="mxinfo" id="T1:U71"><span class="mxinfo" id="T1:U72"><span class="fcn" id="F1N2:B96">Acoeff</span>(<span class="mxinfo" id="T1:U73">1</span>,<span class="var type1" id="S22T1U98">tIdx</span>,<span class="mxinfo" id="T1:U75"><span class="var type1" id="S7T2U100">x</span>(<span class="var type1" id="S18T1U101">j</span>)</span>,<span class="mxinfo" id="T1:U78"><span class="var type1" id="S5T2U103">t</span>(<span class="var type1" id="S19T1U104">i</span>)</span>,<span class="var type1" id="S6T2U105">gridT</span>)</span>*<span class="mxinfo" id="T1:U82"><span class="var type1" id="S10T21U107">q1j</span>(<span class="var type1" id="S22T1U108">tIdx</span>)</span></span></span>-<span class="keyword">...</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo" id="T1:U49"><span class="mxinfo" id="T1:U51"><span class="mxinfo" id="T1:U52"><span class="mxinfo" id="T1:U53">                <span class="mxinfo" id="T1:U85"><span class="mxinfo" id="T1:U86"><span class="fcn" id="F74N3:B111">Bcoeff</span>(<span class="mxinfo" id="T1:U87">0</span>,<span class="var type1" id="S22T1U113">tIdx</span>,<span class="mxinfo" id="T1:U89"><span class="var type1" id="S7T2U115">x</span>(<span class="var type1" id="S18T1U116">j</span>)</span>,<span class="mxinfo" id="T1:U92"><span class="var type1" id="S5T2U118">t</span>(<span class="var type1" id="S19T1U119">i</span>)</span>,<span class="var type1" id="S6T2U120">gridT</span>)</span>*<span class="mxinfo" id="T1:U96"><span class="var type1" id="S11T20U122">h0j</span>(<span class="var type1" id="S22T1U123">tIdx</span>)</span></span></span> - <span class="mxinfo" id="T1:U99"><span class="mxinfo" id="T1:U100"><span class="fcn" id="F74N3:B126">Bcoeff</span>(<span class="mxinfo" id="T1:U101">1</span>,<span class="var type1" id="S22T1U128">tIdx</span>,<span class="mxinfo" id="T1:U103"><span class="var type1" id="S7T2U130">x</span>(<span class="var type1" id="S18T1U131">j</span>)</span>,<span class="mxinfo" id="T1:U106"><span class="var type1" id="S5T2U133">t</span>(<span class="var type1" id="S19T1U134">i</span>)</span>, <span class="var type1" id="S6T2U135">gridT</span>)</span>*<span class="mxinfo" id="T1:U110"><span class="var type1" id="S12T20U137">h1j</span>(<span class="var type1" id="S22T1U138">tIdx</span>)</span></span></span>+<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="45,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo" id="T1:U49"><span class="mxinfo" id="T1:U51">                <span class="mxinfo" id="T1:U113"><span class="mxinfo" id="T1:U114"><span class="fcn" id="F82N11:B141">Dcoeff</span>(<span class="var type1" id="S7T2U142">x</span>,<span class="var type1" id="S22T1U143">tIdx</span>,<span class="mxinfo" id="T1:U117"><span class="var type1" id="S7T2U145">x</span>(<span class="var type1" id="S18T1U146">j</span>)</span>,<span class="mxinfo" id="T1:U120"><span class="var type1" id="S5T2U148">t</span>(<span class="var type1" id="S19T1U149">i</span>)</span>,<span class="var type1" id="S6T2U150">gridT</span>,<span class="mxinfo" id="T2:U124"><span class="var type1" id="S13T20U152">f</span>(<span class="var type1" id="S19T1U153">i</span>,:)</span>)</span>*<span class="mxinfo" id="T1:U127"><span class="var type1" id="S14T21U156">r</span>(<span class="var type1" id="S22T1U157">tIdx</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,28" id="srcline28">28</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,29" id="srcline29">29</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="45,30" id="srcline30">30</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S26T1U160">ssIdx</span> = <span class="mxinfo" id="T1:U131">1</span>:<span class="var type1" id="S3T1U163">N0</span> <span class="comment">% space index</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,31" id="srcline31">31</a></span><span class="line">            <span class="mxinfo" id="T1:U133"><span class="var type1" id="S21T1U166">sSpace</span> = <span class="mxinfo" id="T1:U135"><span class="var type1" id="S21T1U168">sSpace</span> +<span class="mxinfo" id="T1:U137"><span class="mxinfo" id="T1:U138"><span class="fcn" id="F80N9:B171">Ccoeff</span>(<span class="var type1" id="S26T1U172">ssIdx</span>,<span class="mxinfo" id="T1:U140"><span class="var type1" id="S7T2U174">x</span>(<span class="var type1" id="S18T1U175">j</span>)</span>,<span class="mxinfo" id="T1:U143"><span class="var type1" id="S5T2U177">t</span>(<span class="var type1" id="S19T1U178">i</span>)</span>,<span class="var type1" id="S6T2U179">gridT</span>)</span>*<span class="mxinfo" id="T1:U147"><span class="var type1" id="S8T2U181">u0</span>(<span class="var type1" id="S26T1U182">ssIdx</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,32" id="srcline32">32</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,33" id="srcline33">33</a></span><span class="line">        <span class="mxinfo" id="T1:U150"><span class="mxinfo" id="T1:U151"><span class="var type1" id="S2T20U186">u</span>(<span class="var type1" id="S19T1U187">i</span>,<span class="var type1" id="S18T1U188">j</span>)</span> = <span class="mxinfo" id="T1:U155">(<span class="mxinfo" id="T1:U156"><span class="var type1" id="S20T1U192">sTime</span>+<span class="var type1" id="S21T1U193">sSpace</span></span>)*<span class="mxinfo" id="T1:U159"><span class="var type1" id="S15T2U195">eta</span>(<span class="var type1" id="S18T1U196">j</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="45,34" id="srcline34">34</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="45,35" id="srcline35">35</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
</pre>
