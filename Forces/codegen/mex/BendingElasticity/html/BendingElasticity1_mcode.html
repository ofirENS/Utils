<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T2U3">force</span> = BendingElasticity(<span class="var type1" id="S3T2U6">pos</span>, <span class="var type1" id="S4T2U7">dist</span>,<span class="var type1" id="S5T1U8">bendingConst</span>,<span class="var type1" id="S6T2U9">angle0</span>, <span class="var type1" id="S7T3U10">affectedParticles</span>,<span class="var type1" id="S8T1U11">numParticles</span>,<span class="var type1" id="S9T1U12">dimension</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%===========</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% Calculate the force on each particle given its connectivity</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% numParticles = size(pos,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% dimension    = size(pos,2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo" id="T2:U9"><span class="var type1" id="S2T2U15">force</span>        = <span class="mxinfo" id="T2:U11">zeros(<span class="var type1" id="S8T1U18">numParticles</span>,<span class="var type1" id="S9T1U19">dimension</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% if ~exist('affectedParticles','var')</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%     affectedParticles = 1:size(pos,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="comment">% F1 = @(pos,dist,i,cosTheta0)((pos(i-2,:)-pos(i-1,:))*(pos(i,:)-pos(i-1,:))'./(dist(i-2,i-1)*dist(i-1,i)) -cosTheta0)*(pos(i-2,:)-pos(i-1,:))./(dist(i-2,i-1)*dist(i,i-1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="comment">% F2 = @(pos,dist,i,cosTheta0)((pos(i-1,:)-pos(i,:))*(pos(i+1,:)-pos(i,:))'./(dist(i-1,i)*dist(i+1,i)) -cosTheta0)* (2*pos(i,:)-pos(i-1,:)-pos(i+1,:))./(dist(i-1,i)*dist(i+1,i));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="comment">% F3 = @(pos,dist,i,cosTheta0)((pos(i+2,:)-pos(i+1,:))*(pos(i,:)-pos(i+1,:))'./(dist(i+2,i+1)*dist(i+1,i)) -cosTheta0)* (pos(i+2,:)-pos(i+1,:))./(dist(i+2,i+1)*dist(i,i+1)); </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="comment">% pos = pos;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="comment">% dist = dist;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo" id="T2:U14"><span class="var type1" id="S11T2U22">cosTheta0</span>    = <span class="mxinfo" id="T2:U16">cos(<span class="var type1" id="S6T2U25">angle0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T5:U18"><span class="var type1" id="S8T1U29">numParticles</span>&gt;<span class="mxinfo" id="T1:U20">2</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S13T1U33">pIdx</span> = <span class="mxinfo" id="T1:U22">1</span>:<span class="mxinfo" id="T1:U23">numel(<span class="var type1" id="S7T3U38">affectedParticles</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">      <span class="mxinfo" id="T1:U25"><span class="var type1" id="S15T1U41">i</span> = <span class="mxinfo" id="T1:U27"><span class="var type1" id="S7T3U43">affectedParticles</span>(<span class="var type1" id="S13T1U44">pIdx</span>)</span></span>        </span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo" id="T5:U30"><span class="var type1" id="S15T1U49">i</span>==<span class="mxinfo" id="T1:U32">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">         <span class="mxinfo" id="T31:U33"><span class="mxinfo" id="T31:U34"><span class="var type1" id="S2T2U54">force</span>(<span class="mxinfo" id="T1:U36">1</span>,<span class="mxinfo" id="T31:U37"><span class="mxinfo" id="T1:U38">1</span>:<span class="mxinfo" id="T1:U39">3</span></span>)</span> = (<span class="mxinfo" id="T4:U40">(<span class="mxinfo" id="T2:U41"><span class="mxinfo" id="T1:U42">(<span class="mxinfo" id="T1:U43">(<span class="mxinfo" id="T4:U44"><span class="mxinfo" id="T4:U45"><span class="var type1" id="S3T2U69">pos</span>(<span class="mxinfo" id="T1:U47"><span class="var type1" id="S15T1U71">i</span>+<span class="mxinfo" id="T1:U49">2</span></span>,:)</span>-<span class="mxinfo" id="T4:U50"><span class="var type1" id="S3T2U75">pos</span>(<span class="mxinfo" id="T1:U52"><span class="var type1" id="S15T1U77">i</span>+<span class="mxinfo" id="T1:U54">1</span></span>,:)</span></span>)*<span class="mxinfo" id="T3:U55">(<span class="mxinfo" id="T4:U56"><span class="mxinfo" id="T4:U57"><span class="var type1" id="S3T2U84">pos</span>(<span class="var type1" id="S15T1U85">i</span>,:)</span>-<span class="mxinfo" id="T4:U60"><span class="var type1" id="S3T2U88">pos</span>(<span class="mxinfo" id="T1:U62"><span class="var type1" id="S15T1U90">i</span>+<span class="mxinfo" id="T1:U64">1</span></span>,:)</span></span>)'</span></span>)/(<span class="mxinfo" id="T1:U65"><span class="mxinfo" id="T1:U66"><span class="var type1" id="S4T2U96">dist</span>(<span class="mxinfo" id="T1:U68"><span class="var type1" id="S15T1U98">i</span>+<span class="mxinfo" id="T1:U70">2</span></span>,<span class="mxinfo" id="T1:U71"><span class="var type1" id="S15T1U101">i</span>+<span class="mxinfo" id="T1:U73">1</span></span>)</span>*<span class="mxinfo" id="T1:U74"><span class="var type1" id="S4T2U104">dist</span>(<span class="mxinfo" id="T1:U76"><span class="var type1" id="S15T1U106">i</span>+<span class="mxinfo" id="T1:U78">1</span></span>,<span class="var type1" id="S15T1U108">i</span>)</span></span>)</span> -<span class="var type1" id="S11T2U109">cosTheta0</span></span>).* (<span class="mxinfo" id="T4:U81">(<span class="mxinfo" id="T4:U82"><span class="mxinfo" id="T4:U83"><span class="var type1" id="S3T2U115">pos</span>(<span class="mxinfo" id="T1:U85"><span class="var type1" id="S15T1U117">i</span>+<span class="mxinfo" id="T1:U87">2</span></span>,:)</span>-<span class="mxinfo" id="T4:U88"><span class="var type1" id="S3T2U121">pos</span>(<span class="mxinfo" id="T1:U90"><span class="var type1" id="S15T1U123">i</span>+<span class="mxinfo" id="T1:U92">1</span></span>,:)</span></span>)./(<span class="mxinfo" id="T1:U93"><span class="mxinfo" id="T1:U94"><span class="var type1" id="S4T2U129">dist</span>(<span class="mxinfo" id="T1:U96"><span class="var type1" id="S15T1U131">i</span>+<span class="mxinfo" id="T1:U98">2</span></span>,<span class="mxinfo" id="T1:U99"><span class="var type1" id="S15T1U134">i</span>+<span class="mxinfo" id="T1:U101">1</span></span>)</span>*<span class="mxinfo" id="T1:U102"><span class="var type1" id="S4T2U137">dist</span>(<span class="var type1" id="S15T1U138">i</span>,<span class="mxinfo" id="T1:U105"><span class="var type1" id="S15T1U140">i</span>+<span class="mxinfo" id="T1:U107">1</span></span>)</span></span>)</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">         </span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">    <span class="keyword">elseif</span> <span class="mxinfo" id="T5:U108">all(<span class="mxinfo" id="T24:U109">[<span class="mxinfo" id="T5:U110"><span class="var type1" id="S15T1U148">i</span>== <span class="mxinfo" id="T1:U112">2</span></span>, <span class="mxinfo" id="T5:U113"><span class="var type1" id="S15T1U151">i</span>~=(<span class="mxinfo" id="T1:U115"><span class="var type1" id="S8T1U154">numParticles</span>-<span class="mxinfo" id="T1:U117">1</span></span>)</span>]</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">         <span class="mxinfo" id="T31:U118"><span class="mxinfo" id="T31:U119"><span class="var type1" id="S2T2U159">force</span>(<span class="mxinfo" id="T1:U121">2</span>,<span class="mxinfo" id="T31:U122"><span class="mxinfo" id="T1:U123">1</span>:<span class="mxinfo" id="T1:U124">3</span></span>)</span> = (<span class="mxinfo" id="T4:U125"><span class="mxinfo" id="T4:U126">(<span class="mxinfo" id="T2:U127"><span class="mxinfo" id="T1:U128">(<span class="mxinfo" id="T1:U129">(<span class="mxinfo" id="T4:U130"><span class="mxinfo" id="T4:U131"><span class="var type1" id="S3T2U175">pos</span>(<span class="mxinfo" id="T1:U133"><span class="var type1" id="S15T1U177">i</span>-<span class="mxinfo" id="T1:U135">1</span></span>,:)</span>-<span class="mxinfo" id="T4:U136"><span class="var type1" id="S3T2U181">pos</span>(<span class="var type1" id="S15T1U182">i</span>,:)</span></span>)*<span class="mxinfo" id="T3:U139">(<span class="mxinfo" id="T4:U140"><span class="mxinfo" id="T4:U141"><span class="var type1" id="S3T2U188">pos</span>(<span class="mxinfo" id="T1:U143"><span class="var type1" id="S15T1U190">i</span>+<span class="mxinfo" id="T1:U145">1</span></span>,:)</span>-<span class="mxinfo" id="T4:U146"><span class="var type1" id="S3T2U194">pos</span>(<span class="var type1" id="S15T1U195">i</span>,:)</span></span>)'</span></span>)/(<span class="mxinfo" id="T1:U149"><span class="mxinfo" id="T1:U150"><span class="var type1" id="S4T2U200">dist</span>(<span class="mxinfo" id="T1:U152"><span class="var type1" id="S15T1U202">i</span>-<span class="mxinfo" id="T1:U154">1</span></span>,<span class="var type1" id="S15T1U204">i</span>)</span>*<span class="mxinfo" id="T1:U156"><span class="var type1" id="S4T2U206">dist</span>(<span class="mxinfo" id="T1:U158"><span class="var type1" id="S15T1U208">i</span>+<span class="mxinfo" id="T1:U160">1</span></span>,<span class="var type1" id="S15T1U210">i</span>)</span></span>)</span> -<span class="var type1" id="S11T2U211">cosTheta0</span></span>).* (<span class="mxinfo" id="T4:U163">(<span class="mxinfo" id="T4:U164"><span class="mxinfo" id="T4:U165"><span class="mxinfo" id="T4:U166"><span class="mxinfo" id="T1:U167">2</span>*<span class="mxinfo" id="T4:U168"><span class="var type1" id="S3T2U220">pos</span>(<span class="var type1" id="S15T1U221">i</span>,:)</span></span>-<span class="mxinfo" id="T4:U171"><span class="var type1" id="S3T2U224">pos</span>(<span class="mxinfo" id="T1:U173"><span class="var type1" id="S15T1U226">i</span>-<span class="mxinfo" id="T1:U175">1</span></span>,:)</span></span>-<span class="mxinfo" id="T4:U176"><span class="var type1" id="S3T2U230">pos</span>(<span class="mxinfo" id="T1:U178"><span class="var type1" id="S15T1U232">i</span>+<span class="mxinfo" id="T1:U180">1</span></span>,:)</span></span>)./(<span class="mxinfo" id="T1:U181"><span class="mxinfo" id="T1:U182"><span class="var type1" id="S4T2U238">dist</span>(<span class="mxinfo" id="T1:U184"><span class="var type1" id="S15T1U240">i</span>-<span class="mxinfo" id="T1:U186">1</span></span>,<span class="var type1" id="S15T1U242">i</span>)</span>*<span class="mxinfo" id="T1:U188"><span class="var type1" id="S4T2U244">dist</span>(<span class="mxinfo" id="T1:U190"><span class="var type1" id="S15T1U246">i</span>+<span class="mxinfo" id="T1:U192">1</span></span>,<span class="var type1" id="S15T1U248">i</span>)</span></span>)</span>)</span>+<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo" id="T31:U118"><span class="mxinfo" id="T4:U125">                                                           <span class="mxinfo" id="T4:U194">(<span class="mxinfo" id="T2:U195"><span class="mxinfo" id="T1:U196">(<span class="mxinfo" id="T1:U197">(<span class="mxinfo" id="T4:U198"><span class="mxinfo" id="T4:U199"><span class="var type1" id="S3T2U258">pos</span>(<span class="mxinfo" id="T1:U201"><span class="var type1" id="S15T1U260">i</span>+<span class="mxinfo" id="T1:U203">2</span></span>,:)</span>-<span class="mxinfo" id="T4:U204"><span class="var type1" id="S3T2U264">pos</span>(<span class="mxinfo" id="T1:U206"><span class="var type1" id="S15T1U266">i</span>+<span class="mxinfo" id="T1:U208">1</span></span>,:)</span></span>)*<span class="mxinfo" id="T3:U209">(<span class="mxinfo" id="T4:U210"><span class="mxinfo" id="T4:U211"><span class="var type1" id="S3T2U273">pos</span>(<span class="var type1" id="S15T1U274">i</span>,:)</span>-<span class="mxinfo" id="T4:U214"><span class="var type1" id="S3T2U277">pos</span>(<span class="mxinfo" id="T1:U216"><span class="var type1" id="S15T1U279">i</span>+<span class="mxinfo" id="T1:U218">1</span></span>,:)</span></span>)'</span></span>)/(<span class="mxinfo" id="T1:U219"><span class="mxinfo" id="T1:U220"><span class="var type1" id="S4T2U285">dist</span>(<span class="mxinfo" id="T1:U222"><span class="var type1" id="S15T1U287">i</span>+<span class="mxinfo" id="T1:U224">2</span></span>,<span class="mxinfo" id="T1:U225"><span class="var type1" id="S15T1U290">i</span>+<span class="mxinfo" id="T1:U227">1</span></span>)</span>*<span class="mxinfo" id="T1:U228"><span class="var type1" id="S4T2U293">dist</span>(<span class="mxinfo" id="T1:U230"><span class="var type1" id="S15T1U295">i</span>+<span class="mxinfo" id="T1:U232">1</span></span>,<span class="var type1" id="S15T1U297">i</span>)</span></span>)</span> -<span class="var type1" id="S11T2U298">cosTheta0</span></span>).* (<span class="mxinfo" id="T4:U235">(<span class="mxinfo" id="T4:U236"><span class="mxinfo" id="T4:U237"><span class="var type1" id="S3T2U304">pos</span>(<span class="mxinfo" id="T1:U239"><span class="var type1" id="S15T1U306">i</span>+<span class="mxinfo" id="T1:U241">2</span></span>,:)</span>-<span class="mxinfo" id="T4:U242"><span class="var type1" id="S3T2U310">pos</span>(<span class="mxinfo" id="T1:U244"><span class="var type1" id="S15T1U312">i</span>+<span class="mxinfo" id="T1:U246">1</span></span>,:)</span></span>)./(<span class="mxinfo" id="T1:U247"><span class="mxinfo" id="T1:U248"><span class="var type1" id="S4T2U318">dist</span>(<span class="mxinfo" id="T1:U250"><span class="var type1" id="S15T1U320">i</span>+<span class="mxinfo" id="T1:U252">2</span></span>,<span class="mxinfo" id="T1:U253"><span class="var type1" id="S15T1U323">i</span>+<span class="mxinfo" id="T1:U255">1</span></span>)</span>*<span class="mxinfo" id="T1:U256"><span class="var type1" id="S4T2U326">dist</span>(<span class="var type1" id="S15T1U327">i</span>,<span class="mxinfo" id="T1:U259"><span class="var type1" id="S15T1U329">i</span>+<span class="mxinfo" id="T1:U261">1</span></span>)</span></span>)</span>)</span></span>)</span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">         </span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">     <span class="keyword">elseif</span> <span class="mxinfo" id="T5:U262">all(<span class="mxinfo" id="T24:U263">[<span class="mxinfo" id="T5:U264"><span class="var type1" id="S15T1U337">i</span> == <span class="mxinfo" id="T1:U266">2</span></span> ,(<span class="mxinfo" id="T5:U267"><span class="var type1" id="S15T1U341">i</span>==(<span class="mxinfo" id="T1:U269"><span class="var type1" id="S8T1U344">numParticles</span>-<span class="mxinfo" id="T1:U271">1</span></span>)</span>)]</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">           <span class="mxinfo" id="T31:U272"><span class="mxinfo" id="T31:U273"><span class="var type1" id="S2T2U349">force</span>(<span class="mxinfo" id="T1:U275">2</span>,<span class="mxinfo" id="T31:U276"><span class="mxinfo" id="T1:U277">1</span>:<span class="mxinfo" id="T1:U278">3</span></span>)</span> = <span class="mxinfo" id="T4:U279"><span class="var type1" id="S5T1U355">bendingConst</span>.*(<span class="mxinfo" id="T4:U281">(<span class="mxinfo" id="T2:U282"><span class="mxinfo" id="T1:U283">(<span class="mxinfo" id="T1:U284">(<span class="mxinfo" id="T4:U285"><span class="mxinfo" id="T4:U286"><span class="var type1" id="S3T2U366">pos</span>(<span class="mxinfo" id="T1:U288"><span class="var type1" id="S15T1U368">i</span>-<span class="mxinfo" id="T1:U290">1</span></span>,:)</span>-<span class="mxinfo" id="T4:U291"><span class="var type1" id="S3T2U372">pos</span>(<span class="var type1" id="S15T1U373">i</span>,:)</span></span>)*<span class="mxinfo" id="T3:U294">(<span class="mxinfo" id="T4:U295"><span class="mxinfo" id="T4:U296"><span class="var type1" id="S3T2U379">pos</span>(<span class="mxinfo" id="T1:U298"><span class="var type1" id="S15T1U381">i</span>+<span class="mxinfo" id="T1:U300">1</span></span>,:)</span>-<span class="mxinfo" id="T4:U301"><span class="var type1" id="S3T2U385">pos</span>(<span class="var type1" id="S15T1U386">i</span>,:)</span></span>)'</span></span>)/(<span class="mxinfo" id="T1:U304"><span class="mxinfo" id="T1:U305"><span class="var type1" id="S4T2U391">dist</span>(<span class="mxinfo" id="T1:U307"><span class="var type1" id="S15T1U393">i</span>-<span class="mxinfo" id="T1:U309">1</span></span>,<span class="var type1" id="S15T1U395">i</span>)</span>*<span class="mxinfo" id="T1:U311"><span class="var type1" id="S4T2U397">dist</span>(<span class="mxinfo" id="T1:U313"><span class="var type1" id="S15T1U399">i</span>+<span class="mxinfo" id="T1:U315">1</span></span>,<span class="var type1" id="S15T1U401">i</span>)</span></span>)</span> -<span class="var type1" id="S11T2U402">cosTheta0</span></span>).* (<span class="mxinfo" id="T4:U318">(<span class="mxinfo" id="T4:U319"><span class="mxinfo" id="T4:U320"><span class="mxinfo" id="T4:U321"><span class="mxinfo" id="T1:U322">2</span>*<span class="mxinfo" id="T4:U323"><span class="var type1" id="S3T2U411">pos</span>(<span class="var type1" id="S15T1U412">i</span>,:)</span></span>-<span class="mxinfo" id="T4:U326"><span class="var type1" id="S3T2U415">pos</span>(<span class="mxinfo" id="T1:U328"><span class="var type1" id="S15T1U417">i</span>-<span class="mxinfo" id="T1:U330">1</span></span>,:)</span></span>-<span class="mxinfo" id="T4:U331"><span class="var type1" id="S3T2U421">pos</span>(<span class="mxinfo" id="T1:U333"><span class="var type1" id="S15T1U423">i</span>+<span class="mxinfo" id="T1:U335">1</span></span>,:)</span></span>)./(<span class="mxinfo" id="T1:U336"><span class="mxinfo" id="T1:U337"><span class="var type1" id="S4T2U429">dist</span>(<span class="mxinfo" id="T1:U339"><span class="var type1" id="S15T1U431">i</span>-<span class="mxinfo" id="T1:U341">1</span></span>,<span class="var type1" id="S15T1U433">i</span>)</span>*<span class="mxinfo" id="T1:U343"><span class="var type1" id="S4T2U435">dist</span>(<span class="mxinfo" id="T1:U345"><span class="var type1" id="S15T1U437">i</span>+<span class="mxinfo" id="T1:U347">1</span></span>,<span class="var type1" id="S15T1U439">i</span>)</span></span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">           </span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line">    <span class="keyword">elseif</span> <span class="mxinfo" id="T5:U349">all(<span class="mxinfo" id="T24:U350">[<span class="mxinfo" id="T5:U351"><span class="var type1" id="S15T1U446">i</span> == (<span class="mxinfo" id="T1:U353"><span class="var type1" id="S8T1U449">numParticles</span>-<span class="mxinfo" id="T1:U355">1</span></span>)</span> , (<span class="mxinfo" id="T5:U356"><span class="var type1" id="S15T1U453">i</span>~=<span class="mxinfo" id="T1:U358">2</span></span>)]</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">          <span class="mxinfo" id="T31:U359"><span class="mxinfo" id="T31:U360"><span class="var type1" id="S2T2U458">force</span>(<span class="var type1" id="S15T1U459">i</span>,<span class="mxinfo" id="T31:U363"><span class="mxinfo" id="T1:U364">1</span>:<span class="mxinfo" id="T1:U365">3</span></span>)</span> = (<span class="mxinfo" id="T4:U366"><span class="mxinfo" id="T4:U367">(<span class="mxinfo" id="T2:U368"><span class="mxinfo" id="T1:U369">(<span class="mxinfo" id="T1:U370">(<span class="mxinfo" id="T4:U371"><span class="mxinfo" id="T4:U372"><span class="var type1" id="S3T2U474">pos</span>(<span class="mxinfo" id="T1:U374"><span class="var type1" id="S15T1U476">i</span>-<span class="mxinfo" id="T1:U376">1</span></span>,:)</span>-<span class="mxinfo" id="T4:U377"><span class="var type1" id="S3T2U480">pos</span>(<span class="var type1" id="S15T1U481">i</span>,:)</span></span>)  *<span class="mxinfo" id="T3:U380">(<span class="mxinfo" id="T4:U381"><span class="mxinfo" id="T4:U382"><span class="var type1" id="S3T2U487">pos</span>(<span class="mxinfo" id="T1:U384"><span class="var type1" id="S15T1U489">i</span>+<span class="mxinfo" id="T1:U386">1</span></span>,:)</span>-<span class="mxinfo" id="T4:U387"><span class="var type1" id="S3T2U493">pos</span>(<span class="var type1" id="S15T1U494">i</span>,:)</span></span>)'</span></span>)/(<span class="mxinfo" id="T1:U390"><span class="mxinfo" id="T1:U391"><span class="var type1" id="S4T2U499">dist</span>(<span class="mxinfo" id="T1:U393"><span class="var type1" id="S15T1U501">i</span>-<span class="mxinfo" id="T1:U395">1</span></span>,<span class="var type1" id="S15T1U503">i</span>)</span>  *<span class="mxinfo" id="T1:U397"><span class="var type1" id="S4T2U505">dist</span>(<span class="mxinfo" id="T1:U399"><span class="var type1" id="S15T1U507">i</span>+<span class="mxinfo" id="T1:U401">1</span></span>,<span class="var type1" id="S15T1U509">i</span>)</span></span>)</span> -<span class="var type1" id="S11T2U510">cosTheta0</span></span>).*(<span class="mxinfo" id="T4:U404">(<span class="mxinfo" id="T4:U405"><span class="mxinfo" id="T4:U406"><span class="mxinfo" id="T4:U407"><span class="mxinfo" id="T1:U408">2</span>*<span class="mxinfo" id="T4:U409"><span class="var type1" id="S3T2U519">pos</span>(<span class="var type1" id="S15T1U520">i</span>,:)</span></span>-<span class="mxinfo" id="T4:U412"><span class="var type1" id="S3T2U523">pos</span>(<span class="mxinfo" id="T1:U414"><span class="var type1" id="S15T1U525">i</span>-<span class="mxinfo" id="T1:U416">1</span></span>,:)</span></span>-<span class="mxinfo" id="T4:U417"><span class="var type1" id="S3T2U529">pos</span>(<span class="mxinfo" id="T1:U419"><span class="var type1" id="S15T1U531">i</span>+<span class="mxinfo" id="T1:U421">1</span></span>,:)</span></span>)./(<span class="mxinfo" id="T1:U422"><span class="mxinfo" id="T1:U423"><span class="var type1" id="S4T2U537">dist</span>(<span class="mxinfo" id="T1:U425"><span class="var type1" id="S15T1U539">i</span>-<span class="mxinfo" id="T1:U427">1</span></span>,<span class="var type1" id="S15T1U541">i</span>)</span>*<span class="mxinfo" id="T1:U429"><span class="var type1" id="S4T2U543">dist</span>(<span class="mxinfo" id="T1:U431"><span class="var type1" id="S15T1U545">i</span>+<span class="mxinfo" id="T1:U433">1</span></span>,<span class="var type1" id="S15T1U547">i</span>)</span></span>)</span>)</span>+<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"><span class="mxinfo" id="T31:U359"><span class="mxinfo" id="T4:U366">                                                            <span class="mxinfo" id="T4:U435">(<span class="mxinfo" id="T2:U436"><span class="mxinfo" id="T1:U437">(<span class="mxinfo" id="T1:U438">(<span class="mxinfo" id="T4:U439"><span class="mxinfo" id="T4:U440"><span class="var type1" id="S3T2U557">pos</span>(<span class="mxinfo" id="T1:U442"><span class="var type1" id="S15T1U559">i</span>-<span class="mxinfo" id="T1:U444">2</span></span>,:)</span>-<span class="mxinfo" id="T4:U445"><span class="var type1" id="S3T2U563">pos</span>(<span class="mxinfo" id="T1:U447"><span class="var type1" id="S15T1U565">i</span>-<span class="mxinfo" id="T1:U449">1</span></span>,:)</span></span>)*<span class="mxinfo" id="T3:U450">(<span class="mxinfo" id="T4:U451"><span class="mxinfo" id="T4:U452"><span class="var type1" id="S3T2U572">pos</span>(<span class="var type1" id="S15T1U573">i</span>,:)</span>-<span class="mxinfo" id="T4:U455"><span class="var type1" id="S3T2U576">pos</span>(<span class="mxinfo" id="T1:U457"><span class="var type1" id="S15T1U578">i</span>-<span class="mxinfo" id="T1:U459">1</span></span>,:)</span></span>)'</span></span>)/(<span class="mxinfo" id="T1:U460"><span class="mxinfo" id="T1:U461"><span class="var type1" id="S4T2U584">dist</span>(<span class="mxinfo" id="T1:U463"><span class="var type1" id="S15T1U586">i</span>-<span class="mxinfo" id="T1:U465">2</span></span>,<span class="mxinfo" id="T1:U466"><span class="var type1" id="S15T1U589">i</span>-<span class="mxinfo" id="T1:U468">1</span></span>)</span>*<span class="mxinfo" id="T1:U469"><span class="var type1" id="S4T2U592">dist</span>(<span class="mxinfo" id="T1:U471"><span class="var type1" id="S15T1U594">i</span>-<span class="mxinfo" id="T1:U473">1</span></span>,<span class="var type1" id="S15T1U596">i</span>)</span></span>)</span> -<span class="var type1" id="S11T2U597">cosTheta0</span></span>).*(<span class="mxinfo" id="T4:U476">(<span class="mxinfo" id="T4:U477"><span class="mxinfo" id="T4:U478"><span class="var type1" id="S3T2U603">pos</span>(<span class="mxinfo" id="T1:U480"><span class="var type1" id="S15T1U605">i</span>-<span class="mxinfo" id="T1:U482">2</span></span>,:)</span>-<span class="mxinfo" id="T4:U483"><span class="var type1" id="S3T2U609">pos</span>(<span class="mxinfo" id="T1:U485"><span class="var type1" id="S15T1U611">i</span>-<span class="mxinfo" id="T1:U487">1</span></span>,:)</span></span>)./(<span class="mxinfo" id="T1:U488"><span class="mxinfo" id="T1:U489"><span class="var type1" id="S4T2U617">dist</span>(<span class="mxinfo" id="T1:U491"><span class="var type1" id="S15T1U619">i</span>-<span class="mxinfo" id="T1:U493">2</span></span>,<span class="mxinfo" id="T1:U494"><span class="var type1" id="S15T1U622">i</span>-<span class="mxinfo" id="T1:U496">1</span></span>)</span>*<span class="mxinfo" id="T1:U497"><span class="var type1" id="S4T2U625">dist</span>(<span class="var type1" id="S15T1U626">i</span>,<span class="mxinfo" id="T1:U500"><span class="var type1" id="S15T1U628">i</span>-<span class="mxinfo" id="T1:U502">1</span></span>)</span></span>)</span>)</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">    <span class="keyword">elseif</span> <span class="mxinfo" id="T5:U503"><span class="var type1" id="S15T1U632">i</span>== <span class="var type1" id="S8T1U633">numParticles</span></span>        </span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line">         <span class="mxinfo" id="T31:U506"><span class="mxinfo" id="T31:U507"><span class="var type1" id="S2T2U637">force</span>(<span class="var type1" id="S15T1U638">i</span>,<span class="mxinfo" id="T31:U510"><span class="mxinfo" id="T1:U511">1</span>:<span class="mxinfo" id="T1:U512">3</span></span>)</span> = (<span class="mxinfo" id="T4:U513">(<span class="mxinfo" id="T2:U514">(<span class="mxinfo" id="T1:U515">(<span class="mxinfo" id="T1:U516">(<span class="mxinfo" id="T4:U517"><span class="mxinfo" id="T4:U518"><span class="var type1" id="S3T2U653">pos</span>(<span class="mxinfo" id="T1:U520"><span class="var type1" id="S15T1U655">i</span>-<span class="mxinfo" id="T1:U522">2</span></span>,:)</span>-<span class="mxinfo" id="T4:U523"><span class="var type1" id="S3T2U659">pos</span>(<span class="mxinfo" id="T1:U525"><span class="var type1" id="S15T1U661">i</span>-<span class="mxinfo" id="T1:U527">1</span></span>,:)</span></span>)*<span class="mxinfo" id="T3:U528">(<span class="mxinfo" id="T4:U529"><span class="mxinfo" id="T4:U530"><span class="var type1" id="S3T2U668">pos</span>(<span class="var type1" id="S15T1U669">i</span>,:)</span>-<span class="mxinfo" id="T4:U533"><span class="var type1" id="S3T2U672">pos</span>(<span class="mxinfo" id="T1:U535"><span class="var type1" id="S15T1U674">i</span>-<span class="mxinfo" id="T1:U537">1</span></span>,:)</span></span>)'</span></span>)/(<span class="mxinfo" id="T1:U538"><span class="mxinfo" id="T1:U539"><span class="var type1" id="S4T2U680">dist</span>(<span class="mxinfo" id="T1:U541"><span class="var type1" id="S15T1U682">i</span>-<span class="mxinfo" id="T1:U543">2</span></span>,<span class="mxinfo" id="T1:U544"><span class="var type1" id="S15T1U685">i</span>-<span class="mxinfo" id="T1:U546">1</span></span>)</span>*<span class="mxinfo" id="T1:U547"><span class="var type1" id="S4T2U688">dist</span>(<span class="mxinfo" id="T1:U549"><span class="var type1" id="S15T1U690">i</span>-<span class="mxinfo" id="T1:U551">1</span></span>,<span class="var type1" id="S15T1U692">i</span>)</span></span>)</span>) -<span class="var type1" id="S11T2U693">cosTheta0</span></span>).*(<span class="mxinfo" id="T4:U554">(<span class="mxinfo" id="T4:U555"><span class="mxinfo" id="T4:U556"><span class="var type1" id="S3T2U699">pos</span>(<span class="mxinfo" id="T1:U558"><span class="var type1" id="S15T1U701">i</span>-<span class="mxinfo" id="T1:U560">2</span></span>,:)</span>-<span class="mxinfo" id="T4:U561"><span class="var type1" id="S3T2U705">pos</span>(<span class="mxinfo" id="T1:U563"><span class="var type1" id="S15T1U707">i</span>-<span class="mxinfo" id="T1:U565">1</span></span>,:)</span></span>)./(<span class="mxinfo" id="T1:U566"><span class="mxinfo" id="T1:U567"><span class="var type1" id="S4T2U713">dist</span>(<span class="mxinfo" id="T1:U569"><span class="var type1" id="S15T1U715">i</span>-<span class="mxinfo" id="T1:U571">2</span></span>,<span class="mxinfo" id="T1:U572"><span class="var type1" id="S15T1U718">i</span>-<span class="mxinfo" id="T1:U574">1</span></span>)</span>*<span class="mxinfo" id="T1:U575"><span class="var type1" id="S4T2U721">dist</span>(<span class="var type1" id="S15T1U722">i</span>,<span class="mxinfo" id="T1:U578"><span class="var type1" id="S15T1U724">i</span>-<span class="mxinfo" id="T1:U580">1</span></span>)</span></span>)</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line">         <span class="mxinfo" id="T4:U581"><span class="var type1" id="S17T4U729">F1</span> = <span class="mxinfo" id="T4:U583">(<span class="mxinfo" id="T2:U584">(<span class="mxinfo" id="T1:U585">(<span class="mxinfo" id="T1:U586">(<span class="mxinfo" id="T4:U587"><span class="mxinfo" id="T4:U588"><span class="var type1" id="S3T2U740">pos</span>(<span class="mxinfo" id="T1:U590"><span class="var type1" id="S15T1U742">i</span>-<span class="mxinfo" id="T1:U592">2</span></span>,:)</span>-<span class="mxinfo" id="T4:U593"><span class="var type1" id="S3T2U746">pos</span>(<span class="mxinfo" id="T1:U595"><span class="var type1" id="S15T1U748">i</span>-<span class="mxinfo" id="T1:U597">1</span></span>,:)</span></span>)*<span class="mxinfo" id="T3:U598">(<span class="mxinfo" id="T4:U599"><span class="mxinfo" id="T4:U600"><span class="var type1" id="S3T2U755">pos</span>(<span class="var type1" id="S15T1U756">i</span>,:)</span>-<span class="mxinfo" id="T4:U603"><span class="var type1" id="S3T2U759">pos</span>(<span class="mxinfo" id="T1:U605"><span class="var type1" id="S15T1U761">i</span>-<span class="mxinfo" id="T1:U607">1</span></span>,:)</span></span>)'</span></span>)/(<span class="mxinfo" id="T1:U608"><span class="mxinfo" id="T1:U609"><span class="var type1" id="S4T2U767">dist</span>(<span class="mxinfo" id="T1:U611"><span class="var type1" id="S15T1U769">i</span>-<span class="mxinfo" id="T1:U613">2</span></span>,<span class="mxinfo" id="T1:U614"><span class="var type1" id="S15T1U772">i</span>-<span class="mxinfo" id="T1:U616">1</span></span>)</span>*<span class="mxinfo" id="T1:U617"><span class="var type1" id="S4T2U775">dist</span>(<span class="mxinfo" id="T1:U619"><span class="var type1" id="S15T1U777">i</span>-<span class="mxinfo" id="T1:U621">1</span></span>,<span class="var type1" id="S15T1U779">i</span>)</span></span>)</span>)-<span class="var type1" id="S11T2U780">cosTheta0</span></span>).*(<span class="mxinfo" id="T4:U624">(<span class="mxinfo" id="T4:U625"><span class="mxinfo" id="T4:U626"><span class="var type1" id="S3T2U786">pos</span>(<span class="mxinfo" id="T1:U628"><span class="var type1" id="S15T1U788">i</span>-<span class="mxinfo" id="T1:U630">2</span></span>,:)</span>-<span class="mxinfo" id="T4:U631"><span class="var type1" id="S3T2U792">pos</span>(<span class="mxinfo" id="T1:U633"><span class="var type1" id="S15T1U794">i</span>-<span class="mxinfo" id="T1:U635">1</span></span>,:)</span></span>)./(<span class="mxinfo" id="T1:U636"><span class="mxinfo" id="T1:U637"><span class="var type1" id="S4T2U800">dist</span>(<span class="mxinfo" id="T1:U639"><span class="var type1" id="S15T1U802">i</span>-<span class="mxinfo" id="T1:U641">2</span></span>,<span class="mxinfo" id="T1:U642"><span class="var type1" id="S15T1U805">i</span>-<span class="mxinfo" id="T1:U644">1</span></span>)</span>*<span class="mxinfo" id="T1:U645"><span class="var type1" id="S4T2U808">dist</span>(<span class="var type1" id="S15T1U809">i</span>,<span class="mxinfo" id="T1:U648"><span class="var type1" id="S15T1U811">i</span>-<span class="mxinfo" id="T1:U650">1</span></span>)</span></span>)</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line">         <span class="mxinfo" id="T4:U651"><span class="var type1" id="S18T4U815">F2</span> = <span class="mxinfo" id="T4:U653">(<span class="mxinfo" id="T2:U654">(<span class="mxinfo" id="T1:U655">(<span class="mxinfo" id="T1:U656">(<span class="mxinfo" id="T4:U657"><span class="mxinfo" id="T4:U658"><span class="var type1" id="S3T2U826">pos</span>(<span class="mxinfo" id="T1:U660"><span class="var type1" id="S15T1U828">i</span>-<span class="mxinfo" id="T1:U662">1</span></span>,:)</span>-<span class="mxinfo" id="T4:U663"><span class="var type1" id="S3T2U832">pos</span>(<span class="var type1" id="S15T1U833">i</span>,:)</span></span>)  *<span class="mxinfo" id="T3:U666">(<span class="mxinfo" id="T4:U667"><span class="mxinfo" id="T4:U668"><span class="var type1" id="S3T2U839">pos</span>(<span class="mxinfo" id="T1:U670"><span class="var type1" id="S15T1U841">i</span>+<span class="mxinfo" id="T1:U672">1</span></span>,:)</span>-<span class="mxinfo" id="T4:U673"><span class="var type1" id="S3T2U845">pos</span>(<span class="var type1" id="S15T1U846">i</span>,:)</span></span>)'</span></span>)/(<span class="mxinfo" id="T1:U676"><span class="mxinfo" id="T1:U677"><span class="var type1" id="S4T2U851">dist</span>(<span class="mxinfo" id="T1:U679"><span class="var type1" id="S15T1U853">i</span>-<span class="mxinfo" id="T1:U681">1</span></span>,<span class="var type1" id="S15T1U855">i</span>)</span>*<span class="mxinfo" id="T1:U683"><span class="var type1" id="S4T2U857">dist</span>(<span class="mxinfo" id="T1:U685"><span class="var type1" id="S15T1U859">i</span>+<span class="mxinfo" id="T1:U687">1</span></span>,<span class="var type1" id="S15T1U861">i</span>)</span></span>)</span>)  -<span class="var type1" id="S11T2U862">cosTheta0</span></span>).*(<span class="mxinfo" id="T4:U690">(<span class="mxinfo" id="T4:U691"><span class="mxinfo" id="T4:U692"><span class="mxinfo" id="T4:U693"><span class="mxinfo" id="T1:U694">2</span>*<span class="mxinfo" id="T4:U695"><span class="var type1" id="S3T2U871">pos</span>(<span class="var type1" id="S15T1U872">i</span>,:)</span></span>-<span class="mxinfo" id="T4:U698"><span class="var type1" id="S3T2U875">pos</span>(<span class="mxinfo" id="T1:U700"><span class="var type1" id="S15T1U877">i</span>-<span class="mxinfo" id="T1:U702">1</span></span>,:)</span></span>-<span class="mxinfo" id="T4:U703"><span class="var type1" id="S3T2U881">pos</span>(<span class="mxinfo" id="T1:U705"><span class="var type1" id="S15T1U883">i</span>+<span class="mxinfo" id="T1:U707">1</span></span>,:)</span></span>)./(<span class="mxinfo" id="T1:U708"><span class="mxinfo" id="T1:U709"><span class="var type1" id="S4T2U889">dist</span>(<span class="mxinfo" id="T1:U711"><span class="var type1" id="S15T1U891">i</span>-<span class="mxinfo" id="T1:U713">1</span></span>,<span class="var type1" id="S15T1U893">i</span>)</span>*<span class="mxinfo" id="T1:U715"><span class="var type1" id="S4T2U895">dist</span>(<span class="mxinfo" id="T1:U717"><span class="var type1" id="S15T1U897">i</span>+<span class="mxinfo" id="T1:U719">1</span></span>,<span class="var type1" id="S15T1U899">i</span>)</span></span>)</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line">         <span class="mxinfo" id="T4:U721"><span class="var type1" id="S19T4U902">F3</span> = <span class="mxinfo" id="T4:U723">(<span class="mxinfo" id="T2:U724">(<span class="mxinfo" id="T1:U725">(<span class="mxinfo" id="T1:U726">(<span class="mxinfo" id="T4:U727"><span class="mxinfo" id="T4:U728"><span class="var type1" id="S3T2U913">pos</span>(<span class="mxinfo" id="T1:U730"><span class="var type1" id="S15T1U915">i</span>+<span class="mxinfo" id="T1:U732">2</span></span>,:)</span>-<span class="mxinfo" id="T4:U733"><span class="var type1" id="S3T2U919">pos</span>(<span class="mxinfo" id="T1:U735"><span class="var type1" id="S15T1U921">i</span>+<span class="mxinfo" id="T1:U737">1</span></span>,:)</span></span>)*<span class="mxinfo" id="T3:U738">(<span class="mxinfo" id="T4:U739"><span class="mxinfo" id="T4:U740"><span class="var type1" id="S3T2U928">pos</span>(<span class="var type1" id="S15T1U929">i</span>,:)</span>-<span class="mxinfo" id="T4:U743"><span class="var type1" id="S3T2U932">pos</span>(<span class="mxinfo" id="T1:U745"><span class="var type1" id="S15T1U934">i</span>+<span class="mxinfo" id="T1:U747">1</span></span>,:)</span></span>)'</span></span>)/(<span class="mxinfo" id="T1:U748"><span class="mxinfo" id="T1:U749"><span class="var type1" id="S4T2U940">dist</span>(<span class="mxinfo" id="T1:U751"><span class="var type1" id="S15T1U942">i</span>+<span class="mxinfo" id="T1:U753">2</span></span>,<span class="mxinfo" id="T1:U754"><span class="var type1" id="S15T1U945">i</span>+<span class="mxinfo" id="T1:U756">1</span></span>)</span>*<span class="mxinfo" id="T1:U757"><span class="var type1" id="S4T2U948">dist</span>(<span class="mxinfo" id="T1:U759"><span class="var type1" id="S15T1U950">i</span>+<span class="mxinfo" id="T1:U761">1</span></span>,<span class="var type1" id="S15T1U952">i</span>)</span></span>)</span>)-<span class="var type1" id="S11T2U953">cosTheta0</span></span>).*(<span class="mxinfo" id="T4:U764">(<span class="mxinfo" id="T4:U765"><span class="mxinfo" id="T4:U766"><span class="var type1" id="S3T2U959">pos</span>(<span class="mxinfo" id="T1:U768"><span class="var type1" id="S15T1U961">i</span>+<span class="mxinfo" id="T1:U770">2</span></span>,:)</span>-<span class="mxinfo" id="T4:U771"><span class="var type1" id="S3T2U965">pos</span>(<span class="mxinfo" id="T1:U773"><span class="var type1" id="S15T1U967">i</span>+<span class="mxinfo" id="T1:U775">1</span></span>,:)</span></span>)./(<span class="mxinfo" id="T1:U776"><span class="mxinfo" id="T1:U777"><span class="var type1" id="S4T2U973">dist</span>(<span class="mxinfo" id="T1:U779"><span class="var type1" id="S15T1U975">i</span>+<span class="mxinfo" id="T1:U781">2</span></span>,<span class="mxinfo" id="T1:U782"><span class="var type1" id="S15T1U978">i</span>+<span class="mxinfo" id="T1:U784">1</span></span>)</span>*<span class="mxinfo" id="T1:U785"><span class="var type1" id="S4T2U981">dist</span>(<span class="var type1" id="S15T1U982">i</span>,<span class="mxinfo" id="T1:U788"><span class="var type1" id="S15T1U984">i</span>+<span class="mxinfo" id="T1:U790">1</span></span>)</span></span>)</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line">         </span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line">         </span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line">                  </span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line">        <span class="mxinfo" id="T31:U791"><span class="mxinfo" id="T31:U792"><span class="var type1" id="S2T2U989">force</span>(<span class="var type1" id="S15T1U990">i</span>,<span class="mxinfo" id="T31:U795"><span class="mxinfo" id="T1:U796">1</span>:<span class="mxinfo" id="T1:U797">3</span></span>)</span>= (<span class="mxinfo" id="T4:U798"><span class="mxinfo" id="T4:U799"><span class="mxinfo" id="T4:U800">(<span class="mxinfo" id="T2:U801">(<span class="mxinfo" id="T1:U802">(<span class="mxinfo" id="T1:U803">(<span class="mxinfo" id="T4:U804"><span class="mxinfo" id="T4:U805"><span class="var type1" id="S3T2U1007">pos</span>(<span class="mxinfo" id="T1:U807"><span class="var type1" id="S15T1U1009">i</span>-<span class="mxinfo" id="T1:U809">2</span></span>,:)</span>-<span class="mxinfo" id="T4:U810"><span class="var type1" id="S3T2U1013">pos</span>(<span class="mxinfo" id="T1:U812"><span class="var type1" id="S15T1U1015">i</span>-<span class="mxinfo" id="T1:U814">1</span></span>,:)</span></span>)*<span class="mxinfo" id="T3:U815">(<span class="mxinfo" id="T4:U816"><span class="mxinfo" id="T4:U817"><span class="var type1" id="S3T2U1022">pos</span>(<span class="var type1" id="S15T1U1023">i</span>,:)</span>-<span class="mxinfo" id="T4:U820"><span class="var type1" id="S3T2U1026">pos</span>(<span class="mxinfo" id="T1:U822"><span class="var type1" id="S15T1U1028">i</span>-<span class="mxinfo" id="T1:U824">1</span></span>,:)</span></span>)'</span></span>)/(<span class="mxinfo" id="T1:U825"><span class="mxinfo" id="T1:U826"><span class="var type1" id="S4T2U1034">dist</span>(<span class="mxinfo" id="T1:U828"><span class="var type1" id="S15T1U1036">i</span>-<span class="mxinfo" id="T1:U830">2</span></span>,<span class="mxinfo" id="T1:U831"><span class="var type1" id="S15T1U1039">i</span>-<span class="mxinfo" id="T1:U833">1</span></span>)</span>*<span class="mxinfo" id="T1:U834"><span class="var type1" id="S4T2U1042">dist</span>(<span class="mxinfo" id="T1:U836"><span class="var type1" id="S15T1U1044">i</span>-<span class="mxinfo" id="T1:U838">1</span></span>,<span class="var type1" id="S15T1U1046">i</span>)</span></span>)</span>)-<span class="var type1" id="S11T2U1047">cosTheta0</span></span>).*(<span class="mxinfo" id="T4:U841">(<span class="mxinfo" id="T4:U842"><span class="mxinfo" id="T4:U843"><span class="var type1" id="S3T2U1053">pos</span>(<span class="mxinfo" id="T1:U845"><span class="var type1" id="S15T1U1055">i</span>-<span class="mxinfo" id="T1:U847">2</span></span>,:)</span>-<span class="mxinfo" id="T4:U848"><span class="var type1" id="S3T2U1059">pos</span>(<span class="mxinfo" id="T1:U850"><span class="var type1" id="S15T1U1061">i</span>-<span class="mxinfo" id="T1:U852">1</span></span>,:)</span></span>)./(<span class="mxinfo" id="T1:U853"><span class="mxinfo" id="T1:U854"><span class="var type1" id="S4T2U1067">dist</span>(<span class="mxinfo" id="T1:U856"><span class="var type1" id="S15T1U1069">i</span>-<span class="mxinfo" id="T1:U858">2</span></span>,<span class="mxinfo" id="T1:U859"><span class="var type1" id="S15T1U1072">i</span>-<span class="mxinfo" id="T1:U861">1</span></span>)</span>*<span class="mxinfo" id="T1:U862"><span class="var type1" id="S4T2U1075">dist</span>(<span class="var type1" id="S15T1U1076">i</span>,<span class="mxinfo" id="T1:U865"><span class="var type1" id="S15T1U1078">i</span>-<span class="mxinfo" id="T1:U867">1</span></span>)</span></span>)</span>)</span> +<span class="keyword">...</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line"><span class="mxinfo" id="T31:U791"><span class="mxinfo" id="T4:U798"><span class="mxinfo" id="T4:U799">                      <span class="mxinfo" id="T4:U868">(<span class="mxinfo" id="T2:U869">(<span class="mxinfo" id="T1:U870">(<span class="mxinfo" id="T1:U871">(<span class="mxinfo" id="T4:U872"><span class="mxinfo" id="T4:U873"><span class="var type1" id="S3T2U1090">pos</span>(<span class="mxinfo" id="T1:U875"><span class="var type1" id="S15T1U1092">i</span>-<span class="mxinfo" id="T1:U877">1</span></span>,:)</span>-<span class="mxinfo" id="T4:U878"><span class="var type1" id="S3T2U1096">pos</span>(<span class="var type1" id="S15T1U1097">i</span>,:)</span></span>)  *<span class="mxinfo" id="T3:U881">(<span class="mxinfo" id="T4:U882"><span class="mxinfo" id="T4:U883"><span class="var type1" id="S3T2U1103">pos</span>(<span class="mxinfo" id="T1:U885"><span class="var type1" id="S15T1U1105">i</span>+<span class="mxinfo" id="T1:U887">1</span></span>,:)</span>-<span class="mxinfo" id="T4:U888"><span class="var type1" id="S3T2U1109">pos</span>(<span class="var type1" id="S15T1U1110">i</span>,:)</span></span>)'</span></span>)/(<span class="mxinfo" id="T1:U891"><span class="mxinfo" id="T1:U892"><span class="var type1" id="S4T2U1115">dist</span>(<span class="mxinfo" id="T1:U894"><span class="var type1" id="S15T1U1117">i</span>-<span class="mxinfo" id="T1:U896">1</span></span>,<span class="var type1" id="S15T1U1119">i</span>)</span>*<span class="mxinfo" id="T1:U898"><span class="var type1" id="S4T2U1121">dist</span>(<span class="mxinfo" id="T1:U900"><span class="var type1" id="S15T1U1123">i</span>+<span class="mxinfo" id="T1:U902">1</span></span>,<span class="var type1" id="S15T1U1125">i</span>)</span></span>)</span>)  -<span class="var type1" id="S11T2U1126">cosTheta0</span></span>).*(<span class="mxinfo" id="T4:U905">(<span class="mxinfo" id="T4:U906"><span class="mxinfo" id="T4:U907"><span class="mxinfo" id="T4:U908"><span class="mxinfo" id="T1:U909">2</span>*<span class="mxinfo" id="T4:U910"><span class="var type1" id="S3T2U1135">pos</span>(<span class="var type1" id="S15T1U1136">i</span>,:)</span></span>-<span class="mxinfo" id="T4:U913"><span class="var type1" id="S3T2U1139">pos</span>(<span class="mxinfo" id="T1:U915"><span class="var type1" id="S15T1U1141">i</span>-<span class="mxinfo" id="T1:U917">1</span></span>,:)</span></span>-<span class="mxinfo" id="T4:U918"><span class="var type1" id="S3T2U1145">pos</span>(<span class="mxinfo" id="T1:U920"><span class="var type1" id="S15T1U1147">i</span>+<span class="mxinfo" id="T1:U922">1</span></span>,:)</span></span>)./(<span class="mxinfo" id="T1:U923"><span class="mxinfo" id="T1:U924"><span class="var type1" id="S4T2U1153">dist</span>(<span class="mxinfo" id="T1:U926"><span class="var type1" id="S15T1U1155">i</span>-<span class="mxinfo" id="T1:U928">1</span></span>,<span class="var type1" id="S15T1U1157">i</span>)</span>*<span class="mxinfo" id="T1:U930"><span class="var type1" id="S4T2U1159">dist</span>(<span class="mxinfo" id="T1:U932"><span class="var type1" id="S15T1U1161">i</span>+<span class="mxinfo" id="T1:U934">1</span></span>,<span class="var type1" id="S15T1U1163">i</span>)</span></span>)</span>)</span></span>+<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line"><span class="mxinfo" id="T31:U791"><span class="mxinfo" id="T4:U798">                      <span class="mxinfo" id="T4:U936">(<span class="mxinfo" id="T2:U937">(<span class="mxinfo" id="T1:U938">(<span class="mxinfo" id="T1:U939">(<span class="mxinfo" id="T4:U940"><span class="mxinfo" id="T4:U941"><span class="var type1" id="S3T2U1174">pos</span>(<span class="mxinfo" id="T1:U943"><span class="var type1" id="S15T1U1176">i</span>+<span class="mxinfo" id="T1:U945">2</span></span>,:)</span>-<span class="mxinfo" id="T4:U946"><span class="var type1" id="S3T2U1180">pos</span>(<span class="mxinfo" id="T1:U948"><span class="var type1" id="S15T1U1182">i</span>+<span class="mxinfo" id="T1:U950">1</span></span>,:)</span></span>)*<span class="mxinfo" id="T3:U951">(<span class="mxinfo" id="T4:U952"><span class="mxinfo" id="T4:U953"><span class="var type1" id="S3T2U1189">pos</span>(<span class="var type1" id="S15T1U1190">i</span>,:)</span>-<span class="mxinfo" id="T4:U956"><span class="var type1" id="S3T2U1193">pos</span>(<span class="mxinfo" id="T1:U958"><span class="var type1" id="S15T1U1195">i</span>+<span class="mxinfo" id="T1:U960">1</span></span>,:)</span></span>)'</span></span>)/(<span class="mxinfo" id="T1:U961"><span class="mxinfo" id="T1:U962"><span class="var type1" id="S4T2U1201">dist</span>(<span class="mxinfo" id="T1:U964"><span class="var type1" id="S15T1U1203">i</span>+<span class="mxinfo" id="T1:U966">2</span></span>,<span class="mxinfo" id="T1:U967"><span class="var type1" id="S15T1U1206">i</span>+<span class="mxinfo" id="T1:U969">1</span></span>)</span>*<span class="mxinfo" id="T1:U970"><span class="var type1" id="S4T2U1209">dist</span>(<span class="mxinfo" id="T1:U972"><span class="var type1" id="S15T1U1211">i</span>+<span class="mxinfo" id="T1:U974">1</span></span>,<span class="var type1" id="S15T1U1213">i</span>)</span></span>)</span>)-<span class="var type1" id="S11T2U1214">cosTheta0</span></span>).*(<span class="mxinfo" id="T4:U977">(<span class="mxinfo" id="T4:U978"><span class="mxinfo" id="T4:U979"><span class="var type1" id="S3T2U1220">pos</span>(<span class="mxinfo" id="T1:U981"><span class="var type1" id="S15T1U1222">i</span>+<span class="mxinfo" id="T1:U983">2</span></span>,:)</span>-<span class="mxinfo" id="T4:U984"><span class="var type1" id="S3T2U1226">pos</span>(<span class="mxinfo" id="T1:U986"><span class="var type1" id="S15T1U1228">i</span>+<span class="mxinfo" id="T1:U988">1</span></span>,:)</span></span>)./(<span class="mxinfo" id="T1:U989"><span class="mxinfo" id="T1:U990"><span class="var type1" id="S4T2U1234">dist</span>(<span class="mxinfo" id="T1:U992"><span class="var type1" id="S15T1U1236">i</span>+<span class="mxinfo" id="T1:U994">2</span></span>,<span class="mxinfo" id="T1:U995"><span class="var type1" id="S15T1U1239">i</span>+<span class="mxinfo" id="T1:U997">1</span></span>)</span>*<span class="mxinfo" id="T1:U998"><span class="var type1" id="S4T2U1242">dist</span>(<span class="var type1" id="S15T1U1243">i</span>,<span class="mxinfo" id="T1:U1001"><span class="var type1" id="S15T1U1245">i</span>+<span class="mxinfo" id="T1:U1003">1</span></span>)</span></span>)</span>)</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line"><span class="mxinfo" id="T2:U1004"><span class="var type1" id="S2T2U1249">force</span>= <span class="mxinfo" id="T2:U1006"><span class="mxinfo" id="T1:U1007">-<span class="var type1" id="S5T1U1252">bendingConst</span></span>.*<span class="var type1" id="S2T2U1253">force</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
