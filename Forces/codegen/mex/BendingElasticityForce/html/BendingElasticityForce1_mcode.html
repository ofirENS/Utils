<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T31U3">force</span>  = BendingElasticityForce(<span class="var type1" id="S3T3U6">edgeMatX</span>,<span class="var type1" id="S4T3U7">edgeMatY</span>,<span class="var type1" id="S5T3U8">edgeMatZ</span>,<span class="var type1" id="S6T1U9">connectivityMat</span>,<span class="var type1" id="S7T2U10">bendingConst</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%===========</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% Calculate the force on each particle given its connectivity</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo" id="T2:U7"><span class="var type1" id="S8T2U13">numParticles</span> = <span class="mxinfo" id="T2:U9">size(<span class="var type1" id="S6T1U16">connectivityMat</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo" id="T2:U11"><span class="var type1" id="S10T2U20">dimension</span>    = <span class="mxinfo" id="T2:U13">3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo" id="T31:U14"><span class="var type1" id="S2T31U24">force</span>        = <span class="mxinfo" id="T31:U16">zeros(<span class="var type1" id="S8T2U27">numParticles</span>,<span class="mxinfo" id="T2:U18"><span class="var type1" id="S10T2U28">dimension</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S12T2U31">pIdx</span> = <span class="mxinfo" id="T2:U21">1</span>:<span class="var type1" id="S8T2U34">numParticles</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line">    <span class="mxinfo" id="T10:U23"><span class="var type1" id="S13T10U37">edgeVec</span> =  <span class="mxinfo" id="T10:U25">[<span class="mxinfo" id="T30:U26"><span class="var type1" id="S3T3U41">edgeMatX</span>(<span class="var type1" id="S12T2U42">pIdx</span>,<span class="mxinfo" id="T4:U29"><span class="var type1" id="S6T1U44">connectivityMat</span>(<span class="var type1" id="S12T2U45">pIdx</span>,:)</span>)</span>; <span class="mxinfo" id="T30:U32"><span class="var type1" id="S4T3U49">edgeMatY</span>(<span class="var type1" id="S12T2U50">pIdx</span>,<span class="mxinfo" id="T4:U35"><span class="var type1" id="S6T1U52">connectivityMat</span>(<span class="var type1" id="S12T2U53">pIdx</span>,:)</span>)</span>;<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo" id="T10:U23"><span class="mxinfo" id="T10:U25">                    <span class="mxinfo" id="T30:U38"><span class="var type1" id="S5T3U57">edgeMatZ</span>(<span class="var type1" id="S12T2U58">pIdx</span>,<span class="mxinfo" id="T4:U41"><span class="var type1" id="S6T1U60">connectivityMat</span>(<span class="var type1" id="S12T2U61">pIdx</span>,:)</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line">    <span class="comment">% calculate the pairwise angles between the connected</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line">    <span class="comment">% particles</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line">    <span class="mxinfo" id="T2:U44"><span class="var type1" id="S14T2U65">n</span>     = <span class="mxinfo" id="T2:U46">size(<span class="var type1" id="S13T10U68">edgeVec</span>,2)</span></span>;<span class="comment">% number of edge pairs</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T8:U48"><span class="var type1" id="S14T2U73">n</span>&gt;=<span class="mxinfo" id="T2:U50">2</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line">        <span class="mxinfo" id="T2:U51"><span class="var type1" id="S15T2U77">next</span>  = <span class="mxinfo" id="T2:U53">1</span></span>;        </span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">        <span class="mxinfo" id="T2:U54"><span class="var type1" id="S16T2U81">numPairs</span> = <span class="mxinfo" id="T2:U56"><span class="mxinfo" id="T2:U57">factorial(<span class="var type1" id="S14T2U85">n</span>)</span>/(<span class="mxinfo" id="T2:U59"><span class="mxinfo" id="T2:U60">factorial(2)</span>*<span class="mxinfo" id="T2:U61">factorial(<span class="mxinfo" id="T2:U62"><span class="var type1" id="S14T2U94">n</span>-<span class="mxinfo" id="T2:U64">2</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">        <span class="mxinfo" id="T31:U65"><span class="var type1" id="S18T31U98">forceVec</span> = <span class="mxinfo" id="T31:U67">zeros(<span class="var type1" id="S16T2U101">numPairs</span>,<span class="mxinfo" id="T2:U69"><span class="var type1" id="S10T2U102">dimension</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">        <span class="mxinfo" id="T30:U71"><span class="var type1" id="S19T30U105">angle</span>    = <span class="mxinfo" id="T30:U73">zeros(<span class="mxinfo" id="T2:U74">1</span>,<span class="var type1" id="S16T2U109">numPairs</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S20T2U112">a1Idx</span> = <span class="mxinfo" id="T2:U77">1</span>:<span class="var type1" id="S14T2U115">n</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S21T2U118">a2Idx</span> = <span class="mxinfo" id="T2:U80"><span class="var type1" id="S20T2U121">a1Idx</span>+<span class="mxinfo" id="T2:U82">1</span></span>:<span class="var type1" id="S14T2U123">n</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">                <span class="mxinfo" id="T24:U84"><span class="var type1" id="S22T24U126">vec1</span>             = <span class="mxinfo" id="T24:U86"><span class="var type1" id="S13T10U128">edgeVec</span>(:,<span class="var type1" id="S20T2U130">a1Idx</span>)</span></span>;                </span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">                <span class="mxinfo" id="T24:U89"><span class="var type1" id="S23T24U133">vec2</span>             = <span class="mxinfo" id="T24:U91"><span class="var type1" id="S13T10U135">edgeVec</span>(:,<span class="var type1" id="S21T2U137">a2Idx</span>)</span></span>;                </span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">                <span class="mxinfo" id="T2:U94"><span class="mxinfo" id="T2:U95"><span class="var type1" id="S19T30U141">angle</span>(<span class="var type1" id="S15T2U142">next</span>)</span>      = <span class="mxinfo" id="T2:U98">acos(<span class="mxinfo" id="T2:U99"><span class="mxinfo" id="T2:U100">sum(<span class="mxinfo" id="T24:U101"><span class="var type1" id="S22T24U149">vec1</span>.*<span class="var type1" id="S23T24U150">vec2</span></span>)</span>./(<span class="mxinfo" id="T2:U104"><span class="mxinfo" id="T2:U105">norm(<span class="var type1" id="S22T24U155">vec1</span>)</span>*<span class="mxinfo" id="T2:U107">norm(<span class="var type1" id="S23T24U158">vec2</span>)</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">                <span class="mxinfo" id="T24:U109"><span class="var type1" id="S27T24U161">dirVec</span>           =  <span class="mxinfo" id="T24:U111">(<span class="mxinfo" id="T24:U112"><span class="var type1" id="S23T24U165">vec2</span>+<span class="var type1" id="S22T24U166">vec1</span></span>)/<span class="mxinfo" id="T2:U115">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">                <span class="mxinfo" id="T32:U116"><span class="mxinfo" id="T32:U117"><span class="var type1" id="S18T31U171">forceVec</span>(<span class="var type1" id="S15T2U172">next</span>,:)</span> = <span class="mxinfo" id="T24:U120"><span class="mxinfo" id="T2:U121"><span class="var type1" id="S7T2U176">bendingConst</span>*(<span class="mxinfo" id="T2:U123"><span class="mxinfo" id="T2:U124"><span class="mxinfo" id="T2:U125"><span class="var type1" id="S19T30U181">angle</span>(<span class="var type1" id="S15T2U182">next</span>)</span>/<span class="mxinfo" id="T2:U128">pi</span></span> - <span class="mxinfo" id="T2:U129">1</span></span>)</span> * <span class="var type1" id="S27T24U186">dirVec</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">                <span class="mxinfo" id="T2:U131"><span class="var type1" id="S15T2U189">next</span>             = <span class="mxinfo" id="T2:U133"><span class="var type1" id="S15T2U191">next</span>+<span class="mxinfo" id="T2:U135">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">        <span class="comment">% calculate the resulting force vector for the specific</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">        <span class="comment">% particle</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">        <span class="mxinfo" id="T32:U136"><span class="mxinfo" id="T32:U137"><span class="var type1" id="S2T31U196">force</span>(<span class="var type1" id="S12T2U197">pIdx</span>,:)</span> = <span class="mxinfo" id="T32:U140">sum(<span class="var type1" id="S18T31U201">forceVec</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
